<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Samples (WAMP v2)</title>
	
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.11.1.min.js"></script>
    <script type="text/javascript">AUTOBAHN_DEBUG = true;</script>
    <script src="https://autobahn.s3.amazonaws.com/autobahnjs/latest/autobahn.min.jgz"></script>	
	<script src="utility.js" ></script>
    <script src="variables.js" ></script>
	<script src="session-mgr.js"></script>
</head>
    <body>
        <button type="button" id="btnLogin">Login</button>
        <button type="button" id="btnLogout">Logout</button>
        <script type="text/javascript">
            $(function () {

                SessionMgr.statusChangeHandlers.subscribe(function (data) {
                    console.log('Session ' + data.status + '; ');

                    if (data.status == SessionStatus.LOGGED_IN) {
                        console.log('You are logged-in NOW!');
                    }
                    else if (data.status == SessionStatus.LOGGED_OUT) {
                        alert(data.reason);
                    }
                    else if (data.status == SessionStatus.NOT_CONNECTED) {
                        //$.unblockUI();
                        //$.blockUI({ message: null });
                    }
                    else if (data.status == SessionStatus.INIT_COMPLETED) {
                        //$.unblockUI();

                        console.log('---------------------------');
                        console.log('RPC call "/user/basicConfig#get".');
                        SessionMgr.call("/user/basicConfig#get").then(
                              function (result) {
                                  console.log('RPC call "/user/basicConfig#get" succeeded.  response = ' + JSON.stringify(result, null, 4));
                                  if (result.iovation.enabled)
                                      $('<script src="' + result.iovation.javaScriptUrl + '" ><\/script>').appendTo($('body'));
                              }
                              , function (err) {
                                  console.log('RPC call "/user/basicConfig#get" failed, err = ' + JSON.stringify(err, null, 4));
                              }
                            );
                    }
                });
                SessionMgr.init();

                $('#btnLogin').click(function(e) {
                    
                    if (SessionMgr.isLoggedIn()) {
                        alert('You are already logged-in');
                        return;
                    }

                    var parameters = {
                        usernameOrEmail: 'player@greenzorro.com',
                        password: 'player888'
                    };

                    SessionMgr.call("/user#login", parameters).then(
                        function(result) {
                            console.log('RPC call succeed, response = ' + JSON.stringify(result, null, 4));
                        },
                        function(err) {
                            console.log('RPC call failed, error = ' + err.desc);
                        });
                });

                $('#btnLogout').click(function (e) {
                    if (!SessionMgr.isLoggedIn()) {
                        alert('You are not logged-in');
                        return;
                    }

                    console.log('---------------------------');
                    console.log('RPC call "/user#logout"');
                    SessionMgr.call("/user#logout").then(
                      function (result) {

                          console.log('RPC call succeed, response = ' + JSON.stringify(result, null, 4));
                          console.log('---------------------------');
                      },
                      function (err) {
                          console.log('RPC call failed, error = ' + err.desc);
                      }
                    );
                });
            });
        </script>

    </body>

</html>