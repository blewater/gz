<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Samples (WAMP v2)</title>
	
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.11.1.min.js"></script>
    <script type="text/javascript">AUTOBAHN_DEBUG = true;</script>
    <script src="https://autobahn.s3.amazonaws.com/autobahnjs/latest/autobahn.min.jgz"></script>	
	<script src="utility.js" ></script>
    <script src="variables.js" ></script>
	<script src="session-mgr.js"></script>
</head>
    <body>
        <button type="button" id="btnLogin">Login</button>
        <button type="button" id="btnLogout">Logout</button>
        <button type="button" id="btnRegister">Register</button>
        <script type="text/javascript">
            $(function () {

                SessionMgr.statusChangeHandlers.subscribe(function (data) {
                    console.log('Session ' + data.status + '; ');

                    if (data.status == SessionStatus.LOGGED_IN) {
                        console.log('You are logged-in NOW!');
                    }
                    else if (data.status == SessionStatus.LOGGED_OUT) {
                        alert(data.reason);
                    }
                    else if (data.status == SessionStatus.NOT_CONNECTED) {
                        //$.unblockUI();
                        //$.blockUI({ message: null });
                    }
                    else if (data.status == SessionStatus.INIT_COMPLETED) {
                        //$.unblockUI();

                        console.log('---------------------------');
                        console.log('RPC call "/user/basicConfig#get".');
                        SessionMgr.call("/user/basicConfig#get").then(
                              function (result) {
                                  console.log('RPC call "/user/basicConfig#get" succeeded.  response = ' + JSON.stringify(result, null, 4));
                                  if (result.iovation.enabled)
                                      $('<script src="' + result.iovation.javaScriptUrl + '" ><\/script>').appendTo($('body'));
                              }
                              , function (err) {
                                  console.log('RPC call "/user/basicConfig#get" failed, err = ' + JSON.stringify(err, null, 4));
                              }
                            );
                    }
                });
                SessionMgr.init();

                $('#btnLogin').click(function(e) {
                    
                    if (SessionMgr.isLoggedIn()) {
                        alert('You are already logged-in');
                        return;
                    }

                    var parameters = {
                        usernameOrEmail: 'ppet',//'player@greenzorro.com',
                        password: '1q2w3e4r!@#$'//'player888'
                    };

                    SessionMgr.call("/user#login", parameters).then(
                        function(result) {
                            console.log('RPC call succeed, response = ' + JSON.stringify(result, null, 4));
                        },
                        function(err) {
                            console.log('RPC call failed, error = ' + err.desc);
                        });
                });

                $('#btnLogout').click(function (e) {
                    if (!SessionMgr.isLoggedIn()) {
                        alert('You are not logged-in');
                        return;
                    }

                    console.log('---------------------------');
                    console.log('RPC call "/user#logout"');
                    SessionMgr.call("/user#logout").then(
                      function (result) {

                          console.log('RPC call succeed, response = ' + JSON.stringify(result, null, 4));
                          console.log('---------------------------');
                      },
                      function (err) {
                          console.log('RPC call failed, error = ' + err.desc);
                      }
                    );
                });

                $('#btnRegister').click(function (e) {

                    console.log(CookieHelper.get("$sessionID$"));

                    //var parameters = {
                    //    "email": "ppetrogiannakis@gmail.com",
                    //    "password": "1q2w3e4r!@#$",
                    //    "country": "GR",
                    //    "region": 1167,
                    //    "personalID": "",
                    //    "mobilePrefix": "+86",
                    //    "mobile": "146534223",
                    //    "phonePrefix": "+86",
                    //    "phone": "41332132",
                    //    "currency": "EUR",
                    //    "title": "Mr.",
                    //    "firstname": "P",
                    //    "surname": "Pet",
                    //    "birthDate": "1970-12-30",
                    //    "city": "Changsha",
                    //    "address1": "167 Street",
                    //    "address2": "",
                    //    "postalCode": "413000",
                    //    "language": "en",
                    //    "securityQuestion": "What's my mother's name?",
                    //    "securityAnswer": "Kathy",
                    //    "acceptNewsEmail": true,
                    //    "acceptSMSOffer": true,
                    //    "gender": "M",
                    //    "username": "ppetrogiannakis@gmail.com",
                    //    "alias": "ppetrogiannakis@gmail.com",
                    //    "affiliateMarker": "",
                    //    "emailVerificationURL": "http://www.your-size.com/activate.html?key="
                    //};

                    //console.log('---------------------------');
                    //console.log('RPC call "/user#logout"');
                    //SessionMgr.call("/user/account#register", parameters).then(
                    //    function(result) {

                    //        console.log('RPC call succeed, response = ' + JSON.stringify(result, null, 4));
                    //        console.log('---------------------------');
                    //    },
                    //    function(err) {
                    //        console.log('RPC call failed, error = ' + err.desc);
                    //    });

                });
            });
        </script>

    </body>

</html>